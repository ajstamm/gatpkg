<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GAT Technical Notes • NYS EPHT GAT</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GAT Technical Notes">
<meta property="og:description" content="gatpkg">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NYS EPHT GAT</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gat_changelog.html">GAT Change Log</a>
    </li>
    <li>
      <a href="../articles/gat_citation.html">GAT Citation Information</a>
    </li>
    <li>
      <a href="../articles/gat_prepare_shapefile.html">GAT Shapefile Preparation</a>
    </li>
    <li>
      <a href="../articles/gat_results_eval.html">GAT Results Evaluation</a>
    </li>
    <li>
      <a href="../articles/gat_setup.html">GAT Setup Instructions</a>
    </li>
    <li>
      <a href="../articles/gat_tech_notes.html">GAT Technical Notes</a>
    </li>
    <li>
      <a href="../articles/gat_troubleshooting.html">GAT Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/gat_tutorial.html">Tutorial 1: GAT walkthrough</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ajstamm/gatpkg/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="gat_tech_notes_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GAT Technical Notes</h1>
                        <h4 data-toc-skip class="author">Abigail Stamm, Thomas Talbot, and Gwen Babcock</h4>
            
            <h4 data-toc-skip class="date">2023-04-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ajstamm/gatpkg/blob/master/vignettes/gat_tech_notes.Rmd" class="external-link"><code>vignettes/gat_tech_notes.Rmd</code></a></small>
      <div class="hidden name"><code>gat_tech_notes.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="gat-overview">GAT overview<a class="anchor" aria-label="anchor" href="#gat-overview"></a>
</h2>
<p>This package is maintained by the New York State Department of Health (NYSDOH) Environmental Public Health Tracking (EPHT) program. The purpose of this package is to run the Geographic Aggregation Tool (GAT) in R.</p>
<p>Health outcome maps with fine geographic resolution can be misleading due to random fluctuations in disease rates caused by small numbers. In some cases, these maps can also inadvertently disclose confidential data. To overcome these limitations NYSDOH EPHT developed GAT to join neighboring geographic areas together until a user defined population and/or number of cases is reached. GAT can be used to produce maps for the public at the finest geographic resolution practicable.</p>
<p>The input object is a shapefile (*.shp). For shapefile requirements, see <a href="gat_prepare_shapefile.html">Preparing your shapefile for GAT</a>. At minimum, GAT requires a polygon shapefile with a character variable that uniquely identifies areas and a numeric variable to sum for aggregation.</p>
<p>A series of dialog boxes allows the user to select: a variable to uniquely identify areas, one or more aggregation variables, optionally, a variable of areas within which merging will be preferred (ex. county), the amount (sum) the aggregation variable(s) should be aggregated to, and the preferred aggregation method - closest, least value, or ratio.</p>
<p>The output includes: a crosswalk shapefile, an aggregated shapefile with associated data, a PDF with several maps, a comprehensive log, and if requested a KML file. For output regions, most numeric variables will be summed, except variables with the following names, which will be averaged instead: x, y, GATx, GATy, lat, lon, latitude, longitude, and long. Values of character variables will be concatenated. The shapefile can be used in ArcGIS, MapInfo, and QGIS. The KML file can be displayed in Google Earth and other Internet-based mapping programs.</p>
<p>The package includes two embedded shapefiles to use when testing several of the package functions. For details on these shapefiles, enter <code><a href="../reference/hftown.html">?hftown</a></code> or <code><a href="../reference/hfpop.html">?hfpop</a></code> into the R console.</p>
</div>
<div class="section level2">
<h2 id="variables-created-by-gat">Variables created by GAT<a class="anchor" aria-label="anchor" href="#variables-created-by-gat"></a>
</h2>
<p>GAT creates several variables in both the original shapefile, which it resaves as a crosswalk, and the aggregated shapefile. These variables are listed below. For the flag variable, a brief data dictionary is provided both below and in the log produced by GAT, to help identify possible issues in the aggregation.</p>
<p>The crosswalk shapefile will have the following variables added:</p>
<ul>
<li>
<strong>GATflag:</strong> flag of areas that were excluded from aggregation or generated warnings in the log
<ul>
<li>value = 0: no flag</li>
<li>value = 1: area excluded based on exclusion criteria</li>
<li>value = 5: area excluded because the value of the aggregation variable exceeds the maximum value</li>
</ul>
</li>
<li>
<strong>GATid:</strong> GAT-generated identifier indicating which aggregated area each original area fell inside</li>
</ul>
<p>The aggregated shapefile will have the following variables added:</p>
<ul>
<li>
<strong>GATx:</strong> longitude of the aggregated area centroid (population-weighted if using population weighting, otherwise geographic)</li>
<li>
<strong>GATy:</strong> latitude of the aggregated area centroid (population-weighted if using population weighting, otherwise geographic)</li>
<li>
<strong>GATcratio:</strong> compactness ratio, or the area of the polygon over the area of a circle with the same perimeter</li>
<li>
<strong>GATnumIDs:</strong> number of original areas that were merged into each aggregated area</li>
<li>
<strong>GATflag:</strong> flag of areas that were excluded from aggregation or generated warnings in the log
<ul>
<li>value = 0: no flag</li>
<li>value = 1: area excluded based on exclusion criteria</li>
<li>value = 5: area excluded because the value of the aggregation variable exceeds the maximum value</li>
<li>value = 10: value of the aggregation variable is below minimum value, but there are no eligible areas for further aggregation</li>
</ul>
</li>
<li>
<strong>GATpop:</strong> population of the aggregated area, from the population file (applies only if population weighting was selected)</li>
<li>a rate variable with the name the user entered (applies only if rate calculation was requested)</li>
</ul>
</div>
<div class="section level2">
<h2 id="how-gat-identifies-areas-to-merge">How GAT identifies areas to merge<a class="anchor" aria-label="anchor" href="#how-gat-identifies-areas-to-merge"></a>
</h2>
<p>The overall goal of the merging is to create a relatively large number of compact regions that meet the specified criteria. To accomplish this, the areas in the input shapefile are aggregated pairwise until all regions have the minimum values specified.</p>
<div class="section level3">
<h3 id="selecting-the-target-area">Selecting the target area<a class="anchor" aria-label="anchor" href="#selecting-the-target-area"></a>
</h3>
<p>First, a subset of areas is selected that meets the following restrictions:</p>
<ul>
<li>Remove flagged areas (this includes areas indicated by exclusion criteria, with an aggregation value above the maximum, or with no mergeable neighbors)</li>
<li>Remove areas with the values for <em>both</em> aggregation variables above minimum</li>
</ul>
<p>This results in a subset of areas that all require merging. This subset is reordered from the highest values of the aggregation variable(s) to the lowest. If there is only one aggregation variable, the area with the highest value is merged first. If there is more than one aggregation variable, the process is more complicated. When two aggregation variables are selected, each aggregation variable is divided by the minimum value specified for it. The area with the highest proportion is selected to be aggregated first.</p>
<blockquote>
<p>For example, given the following:</p>
<ul>
<li>minimum for first aggregation variable: 1000 population</li>
<li>minimum for second aggregation variable: 100 births</li>
<li>first area: 200 population, 90 births</li>
<li>second area: 400 population, 50 births</li>
</ul>
<p>Calculate proportions of area value over minimum value for the first and second areas as follows:</p>
<ul>
<li>first area: <span class="math inline">\(\frac{200 population}{1000 minimum population} = 0.2\)</span>, <span class="math inline">\(\frac{90 births}{100 minimum births} = 0.9\)</span><br>
maximum proportion = 0.9</li>
<li>second area: <span class="math inline">\(\frac{400 population}{1000 minimum population} = 0.4\)</span>, <span class="math inline">\(\frac{50 births}{100 minimum births} = 0.5\)</span><br>
maximum proportion = 0.5</li>
</ul>
<p>Of these two areas, the first area has a higher maximum proportion, so it will be merged first.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="identifying-eligible-neighbors">Identifying eligible neighbors<a class="anchor" aria-label="anchor" href="#identifying-eligible-neighbors"></a>
</h3>
<p>After the target area has been identified, GAT generates a list of its neighbors. Areas are considered neighbors if they share at least two points with the selected area. However, not all of these neighbors may be eligible for merging. GAT considers several criteria when selecting eligible areas.</p>
<ul>
<li>
<strong>Always ineligible:</strong> Flagged areas, which include areas indicated by exclusion criteria or with an aggregation value above the maximum. In addition, when merged, the resulting areas <em>cannot</em> have values above the maximum (target area value + merge area value <span class="math inline">\(\ngtr\)</span> maximum value).</li>
<li>
<strong>Adjacent:</strong> The default is for areas to merge only to adjacent areas. To override this, use the option <code>runGATprogram(adjacent = FALSE)</code>, which will result in adjacent areas being preferred, but not required.</li>
<li>
<strong>Inside border:</strong> This option is selected in the dialog boxes. If you select a border, GAT will restrict neighbors only to areas within the border. If there are no eligible neighbors within the border and you used the option <code>adjacent = FALSE</code>, GAT will select the closest eligible area within the border, even if it is not adjacent. If you select a border and do not check the box to enforce the border, GAT will consider neighbors outside the border last.</li>
<li>
<strong>Value below minimum:</strong> The default is for GAT to ignore whether the values of neighbors are below the minimum aggregation value. If you want to merge areas whose values are below the minimum aggregation value first, use the option <code>runGATprogram(minfirst = TRUE)</code>. If there are no neighbors with aggregation values below the minimum value, GAT will recheck for neighbors without this restriction.</li>
</ul>
<p>When relaxing eligibility restrictions, GAT drops criteria in this order: Value below minimum (if triggered by <code>minfirst = TRUE</code>), Adjacent (only if <code>adjacent = FALSE</code>), Inside border (only if border not enforced). If no eligible areas are identified after relaxing these restrictions, the target area is flagged as unable to merge further. For each area for which selection criteria were relaxed, a warning is written to the log.</p>
</div>
<div class="section level3">
<h3 id="selecting-the-most-eligible-neighbor">Selecting the most eligible neighbor<a class="anchor" aria-label="anchor" href="#selecting-the-most-eligible-neighbor"></a>
</h3>
<p>If the area does not have adjacent neighbors and you used <code>adjacent = FALSE</code>, GAT will default to the closest geographic centroid unless you chose population weighting, in which case it will use the closest population-weighted centroid. If the area has more than one eligible adjacent neighbor, the next few sections cover how the neighbor to merge is selected, depending on the desired merge type.</p>
<p>The new region then becomes a candidate for additional merging, and merging continues until all regions contain the minimum values of the aggregation variables specified or have been flagged as being unable to merge further.</p>
<div class="section level4">
<h4 id="closest-geographic-centroid">Closest geographic centroid<a class="anchor" aria-label="anchor" href="#closest-geographic-centroid"></a>
</h4>
<p>The target area is merged with the eligible area with the closest straight-line centroid based on the shape of the area. The new centroid is calculated by averaging the latitudes and longitudes of the two areas. This speeds up GAT considerably, but can result in centroids that do not exactly match the area’s center.</p>
<div class="figure">
<img src="images/merge_geo_animated.gif" alt="Animation showing five areas merging by closest geographic centroid" width="50%"><p class="caption">
Merging by closest geographic centroid
</p>
</div>
<p>In the graphic above, the area with the largest value below 5 is E. The closest neighbor to E using geographic centroids is C, so GAT assigns E to merge with C. The next largest value below 5 is in area A, whose closest neighbor is the new area CE, so GAT merges A to CE. The last area below 5 is D, which is closest to B, so GAT merges D with B.</p>
<p>This method provides the most compact areas and can work well for environmental exposures like air pollution and temperature.</p>
</div>
<div class="section level4">
<h4 id="closest-population-weighted-centroid">Closest population-weighted centroid<a class="anchor" aria-label="anchor" href="#closest-population-weighted-centroid"></a>
</h4>
<p>The population file the user selected is used to determine the area’s centroid based on the underlying population. The target area is merged with the eligible area with the closest population-weighted centroid. There are two methods for calculating the population-weighted centroid for the new area. The faster method, which is the default, is to calculate the proportion of the population each area contributes to the merged area, then multiply these proportions by their respective latitudes and longitudes and sum the results. For example, if area A contributes 70% of the population and area B contributes 30% of the population, the new longitude would be <span class="math inline">\(0.7 * longitude_A + 0.3 * longitude_B\)</span>. The slower method recalculates the centroid of the new area using the underlying populations of both areas in the population file. To access this method, use <code>runGATprogram(pwrepeat = TRUE)</code>.</p>
<div class="figure">
<img src="images/merge_pop_animated.gif" alt="Animation showing five areas merging by closest population-weighted centroid" width="50%"><p class="caption">
Merging by closest population-weighted centroid
</p>
</div>
<p>In the graphic above, the area with the largest value below 5 is E. The closest neighbor to E using population-weighted centroids is D, so GAT assigns E to merge with D. The next largest value below 5 is in the new area DE, whose closest neighbor is C, so GAT merges DE to C. The last area below 5 is A, which is closest to B, so GAT merges A with B.</p>
<p>This method provides areas that may sprawl a bit, but are representative of population centers and can work well for disease rates.</p>
</div>
<div class="section level4">
<h4 id="neighbor-with-the-least-value">Neighbor with the least value<a class="anchor" aria-label="anchor" href="#neighbor-with-the-least-value"></a>
</h4>
<p>If there is only one minimum value specified, the area with lowest value is selected. If there are two minimum values specified, the area with the lowest proportion of aggregation variable to minimum value specified is selected.</p>
<div class="figure">
<img src="images/merge_least_animated.gif" alt="Animation showing five areas merging to their neighbor with the least value" width="50%"><p class="caption">
Merging to neighbor with least value
</p>
</div>
<p>In the graphic above, the area with the largest value below 5 is E. E’s neighbor with the smallest value is D, so GAT assigns E to merge with D. The next largest value below 5 is in the new area DE, whose neighbor with the smallest value is A, so GAT merges DE to A.</p>
<p>This method provides the largest number of areas and therefore the greatest granularity. However, it can result in weird snaky shapes and possibly donuts, where a rural area entirely surrounds an urban one.</p>
</div>
<div class="section level4">
<h4 id="neighbor-with-the-most-similar-ratio">Neighbor with the most similar ratio<a class="anchor" aria-label="anchor" href="#neighbor-with-the-most-similar-ratio"></a>
</h4>
<p>The selected area is merged with the area with the least absolute difference between the ratios of the variables chosen for similarity comparison. For example, suppose the variables chosen for similarity comparison are counts of persons under poverty and total population. If the area to be merged has a percent under poverty of 10%, and it has neighbors have 9%, 13%, and 15% under poverty, then then it would be merged with the area with 9% under poverty.</p>
<div class="figure">
<img src="images/merge_similar_animated.gif" alt="Animation showing five areas merging to their neighbor with the most similar ratio" width="50%"><p class="caption">
Merging to neighbor with most similar ratio
</p>
</div>
<p>In the graphic above, the area with the largest value below 5 is E. E’s neighbor with the closest ratio is D, so GAT assigns E to merge with D. The next largest value below 5 is in the new area DE, whose neighbor with the closest ratio is B, so GAT merges DE to B. The last value below 5 is in A, whose neighbor with the closest ratio is C, so GAT merges A to C.</p>
<p>This method works well if you want to create areas of similar populations to investigate social determinants of health.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="thinning-geographic-boundaries">Thinning geographic boundaries<a class="anchor" aria-label="anchor" href="#thinning-geographic-boundaries"></a>
</h2>
<p>The program may merge very slowly if the geographic boundaries are unnecessarily complex. Boundaries can be simplified by a process known as “thinning” (or “simplification” or “integrating” or “generalizing”). Thinning is removing nodes based on how far apart they are and/or their collinearity to decrease the complexity of the maps (see figure below). GIS systems like MapInfo and ArcGIS can be used to thin maps. After thinning, areas should merge much more quickly in the GAT, but the map may appear crude. If high resolution maps are needed for display, the thinned map used for processing data can be linked back to the high resolution boundaries using unique area identifiers.</p>
<div class="figure">
<img src="images/node_spacing.png" alt="Example of three decreasing levels of detail as nodes are thinned" width="80%"><p class="caption">
Comparing detail as nodes are thinned
</p>
</div>
</div>
<div class="section level2">
<h2 id="compactness-ratio">Compactness ratio<a class="anchor" aria-label="anchor" href="#compactness-ratio"></a>
</h2>
<p>The compactness ratio is a measure used to assess how well areas were aggregated. Ideally, areas should be combined with other areas very close to them under the assumption that people tend to live closer to people with whom they are more similar. A circle is the most compact shape, so an area that is relatively round, like St. Lawrence County, New York (below right; compactness ratio = 0.71), will be more compact than an area that is long and narrow, like Cayuga County, New York (below left; compactness ratio = 0.18).</p>
<p>To calculate compactness ratio, the perimeter of the shape is calculated, then a circle with a circumference equal to the perimeter of the shape is drawn and its area is calculated. Next, the area of the shape is divided by the area of the circle. A highly compact shape will have a compactness ratio close to 1.</p>
<div class="figure">
<img src="images/compactness_example.png" alt="Examples of two areas with high and low compactness, with overlaid circles" width="80%"><p class="caption">
Compactness examples
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Abigail Stamm, Gwen Babcock, Centers for Disease Control and Prevention.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
